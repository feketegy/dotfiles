#!/usr/bin/env bash

# close System Settings
osascript -e 'tell application "System Preferences" to quit'

sudo -v

# Global: Timezone
systemsetup -settimezone Europe/Bucharest

# Global: Default 24-hour clock
defaults write com.apple.menuextra.clock Show24Hour 1
defaults write com.apple.menuextra.clock ShowDate 1

# Global: Set languages
defaults write -g AppleLanguages -array "en" "hu" "ro"

# Global: Set default currency
defaults write -g AppleLocale -string "en_US@currency=EUR"

# Global: Set measurements
defaults write -g AppleMeasurementUnits -string "Centimeters"
defaults write -g AppleMetricUnits -bool true

# Global: Disable .DS_Store file creation on network and usb volumes
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

# Global: Expand save panel for finder and print
defaults write -g NSNavPanelExpandedStateForSaveMode -bool true
defaults write -g NSNavPanelExpandedStateForSaveMode2 -bool true
defaults write -g PMPrintingExpandedStateForPrint -bool true
defaults write -g PMPrintingExpandedStateForPrint2 -bool true

# Global: Disable smart quotes and dashes
defaults write -g NSAutomaticQuoteSubstitutionEnabled -bool false
defaults write -g NSAutomaticDashSubstitutionEnabled -bool false

# Input: Set key repeat and delay until repeat to the fastest setting
defaults write -g KeyRepeat -int 1
defaults write -g InitialKeyRepeat -int 10

# Window: Show scrollbars only when scrolling, possible values: WhenScrolling, Automatic, Always
defaults write -g AppleShowScrollBars -string "WhenScrolling"

# Window: Enable spring-loaded directories and remove springing delay
defaults write -g com.apple.springing.enabled -bool true
defaults write -g com.apple.springing.delay -float 0

# Screenshot: Screenshot defaults to png
defaults write com.apple.screencapture type -string "png"

# Screenshot: Disable screenshot shadow
defaults write com.apple.screencapture disable-shadow -bool true

# Screenshot: Enable sub-pixel rendering
defaults write -g AppleFontSmoothing -int 1

# Finder: Disable animations
defaults write com.apple.finder DisableAllAnimations -bool true

# Finder: Show all filename extensions
defaults write -g AppleShowAllExtensions -bool true

# Finder: Show statusbar
defaults write com.apple.finder ShowStatusBar -bool true

# Finder: Show pathbar
defaults write com.apple.finder ShowPathbar -bool true

# Finder: Keep directories on top when sorting by name
defaults write com.apple.finder _FXSortFoldersFirst -bool true

# Finder: Search the current dir by default
defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"

# Finder: Disable warning when changing file extension
defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false

# Finder: Use list view in finder by default, possible values: icnv, clmv, glyv
defaults write com.apple.finder FXPreferredViewStyle -string "Nlsv"

# Dock: 42px dock icon size
defaults write com.apple.dock tilesize -int 42

# Dock: Minimize applications into separate dock icons
defaults write com.apple.dock minimize-to-application -bool false

# Dock: Indicator lights for opened dock apps
defaults write com.apple.dock show-process-indicators -bool true

# Dock: Disable animation when launching dock apps
defaults write com.apple.dock launchanim -bool false

# Dock: Disable dock auto-hide
defaults write com.apple.dock autohide -bool false

# Dock: Disable showing recent apps in the dock
defaults write com.apple.dock show-recents -bool false

# Dock: Minimize/maximize effect that is faster, possible values: scale, genie
defaults write com.apple.dock mineffect -string "scale"

# ----- HACK
# Stop the dock app jumping from one display to another and still have the "Displays have separate spaces" option enabled with this hack, 
# the dock will stay on the main display for 60 seconds while the cursor is at the area on another display where the dock would be placed.
# If the 60 seconds elapsed and the cursor doesn't move, the dock will be moved where the cursor is.
defaults write com.apple.dock autohide-delay -float "60"

brew install sleepwatcher
ln -sfh $DOTFILES/config/sleepwatcher/wakeup.sh $HOME/.wakeup
brew services start sleepwatcher

# Add the automator app to the login items, this will re-execute the command above after every login, as it seems that Sonoma and Sequoia doesn't want to conform.
osascript -e 'tell application "System Events" to make login item at end with properties {path:"/Users/georgefekete/dotfiles/config/automator/stop-dock-jump.app", hidden:false}'
# ----- END HACK

# Spotlight: Stop sending stuff to Apple
defaults write com.apple.lookup lookupEnabled -dict-add suggestionsEnabled -bool no

# Apple Intelligence: disable by default
defaults write com.apple.CloudSubscriptionFeatures.optIn "545129924" -bool "false"

echo -e "\n====================================================="
echo -e "Restart your computer for the changes to take effect."
echo -e "====================================================="
